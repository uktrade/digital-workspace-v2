{% extends "2_col_content.html" %}
{% load static %}
{% load wagtailcore_tags %}
{% load wagtailimages_tags %}
{% load site_alert %}

{% block bookmark %}
{% endblock bookmark %}

{% block body_classes %}homepage{% endblock %}

{% block pre_content %}
    {% include "home/includes/home_banner.html" %}
{% endblock %}

{% block content %}
    <article class="ws-home-wrapper new-home">
        <h1 class="ws-hide">Digital Workspace</h1>

        {# spaceless is required to enable the use of the :empty pseudo css selector #}
        {% spaceless %}
            <section class="homepage-site-alert">
                {% site_alert %}
            </section>
        {% endspaceless %}

        <section aria-labelledby="home-news-items">
            <div class="header-with-action">
                <h2 class="govuk-heading-m" id="home-news-items">Latest News</h2>
                <a class="govuk-link" href="/news-and-views/">View all news</a>
            </div>

            {% comment %} Remove 'dwds' class when using the other base template. {% endcomment %}
            <div class="main-news-item dwds">
                {% if news_items %}
                    {% include "dwds/components/one_up_card.html" with title=news_items.0.title excerpt=news_items.0.excerpt thumbnail=news_items.0.preview_image url=news_items.0.url date=news_items.0.last_published_at %}
                {% endif %}
            </div>

            <ul class="ws-news-grid-items">
                {% for news_item in news_items %}
                    {% if not forloop.first %}
                        <li class="news-item news-item-{{ forloop.counter }}"
                            data-testid="home-news-item">
                            {% include "home/includes/news_item_new.html" with news_item=news_item %}
                        </li>
                    {% endif %}
                {% endfor %}
            </ul>
        </section>

        {% if not hide_news %}
            <section class="block-wrapper govuk-news">
                <h2 class="govuk-heading-m">DBT news from GOV.UK</h2>
                <ul class="two-cols">
                    {% for govuk_news_item in govuk_feed %}
                        <li>
                            <p>
                                <a class="govuk-link" href="{{ govuk_news_item.links.0.href }}">{{ govuk_news_item.title.value }}</a>
                            </p>
                            <p class="govuk-body-xs">{{ govuk_news_item.updated|date:"DATE_FORMAT" }}</p>
                        </li>
                    {% endfor %}
                </ul>
            </section>
        {% endif %}
    </article>
{% endblock content %}

{% block tertiary_col_content %}
    <article class="ws-home-wrapper new-home">
        {% comment %} {% if updates %}
            <section class="updates">
                <h2 class="govuk-heading-m">Updates</h2>
                <ul>
                    {% for update in updates %}
                        <li>
                            <p class="govuk-body-s">{{ update }}</p>
                        </li>
                    {% endfor %}
                </ul>
            </section>
        {% endif %} {% endcomment %}

        <section>
            <h3 class="govuk-heading-m" id="bookmark-menu">Your bookmarks</h3>
            <ul class="bookmarks-wrapper">
                {% for bookmark in bookmarks %}
                    <li>
                        <a class="govuk-link" href="{{ bookmark.page.get_url }}">{{ bookmark.page.title }}</a>
                    </li>
                {% empty %}
                    <li>
                        <p class="govuk-body-s">
                            You have not yet saved any bookmarks. Use the
                            <img src="{% static 'interactions/bookmark-outline.svg' %}"
                                 style="width: 1rem">
                            icon at the top of a page to save it to here.
                        </p>
                    </li>
                {% endfor %}
            </ul>
        </section>

        <section>
            <h3 class="govuk-heading-m" id="quick-link-menu">Quick links</h3>
            <ul class="quick-links-wrapper">
                {% for quick_link in quick_links %}
                    <li>
                        <a class="govuk-link" href="{% pageurl quick_link.link_to %}">{{ quick_link.title }}</a>
                    </li>
                {% endfor %}
            </ul>
        </section>

        <section>
            <h2 class="govuk-heading-m">Popular pages</h2>
            <ul class="ws-whats-popular">
                {% for whats_popular_item in whats_popular_items %}
                    <li class="ws-whats-popular-item">
                        {% image whats_popular_item.preview_image fill-300x100 %}
                        <p>
                            {% if whats_popular_item.link_to %}
                                <a class="govuk-link" href="{% pageurl whats_popular_item.link_to %}">{{ whats_popular_item.title }}</a>
                            {% else %}
                                <a class="govuk-link" href="{{ whats_popular_item.external_url }}">{{ whats_popular_item.title }}</a>
                            {% endif %}
                        </p>
                    </li>
                {% endfor %}
            </ul>
        </section>

        <section>
            <h3 class="govuk-heading-m" id="recently-viewed-menu">Recently viewed</h3>
            <ul class="recently-viewed-wrapper">
                {% for recently_viewed in recently_viewed %}
                    <li>
                        <a class="govuk-link" href="{{ recently_viewed.page.get_url }}">{{ recently_viewed.page.title }}</a>
                    </li>
                {% empty %}
                    <li>
                        <p class="govuk-body-s">The most recent pages you visit will appear here.</p>
                    </li>
                {% endfor %}
            </ul>
        </section>
    </article>
{% endblock tertiary_col_content %}
