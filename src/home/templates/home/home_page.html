{% extends "dwds_content.html" %}
{% load static %}
{% load wagtailcore_tags %}
{% load wagtailimages_tags %}
{% load site_alert %}
{% load cards %}

{% block pre_main %}
    {{ block.super }}
{% endblock pre_main %}

{% block bookmark %}
{% endblock bookmark %}

{% block body_classes %}
    {{ block.super }} homepage new-home
{% endblock body_classes %}

{% block pre_content %}
{% endblock pre_content %}

{% block page_title %}
{% endblock page_title %}

{% block primary_content %}
    <article>
        <section>
            <div class="stack">
                <!-- User selected top priority page cards -->
                {% if not is_empty %}
                    {% for pages in pages_by_news_layout %}
                        <div class="switcher">
                            {% for page in pages %}
                                {% page_to_card page as card %}

                                {% if pages|length == 1 %}
                                    {% include "dwds/components/one_up_card.html" with title=card.title thumbnail=card.thumbnail url=card.url created_date=card.created_date updated_date=card.updated_date comment_count=card.comment_count excerpt=card.excerpt hide_shadow=card.hide_shadow ribbon_text=card.ribbon_text post_title=card.post_title %}
                                {% else %}
                                    {% include card.template with title=card.title thumbnail=card.thumbnail url=card.url created_date=card.created_date updated_date=card.updated_date comment_count=card.comment_count excerpt=card.excerpt hide_shadow=card.hide_shadow ribbon_text=card.ribbon_text post_title=card.post_title %}
                                {% endif %}
                            {% endfor %}
                        </div>
                    {% endfor %}
                {% endif %}

                {% if page.promo_enabled %}
                    {% include 'dwds/components/promo.html' with ribbon_text=page.promo_ribbon_text description=page.promo_description link_url=page.promo_link_url link_text=page.promo_link_text thumbnail=page.promo_image %}
                {% endif %}

                {% if news_items %}
                    {% pages_to_cards news_items True as news_cards %}
                    {% include "dwds/components/card_group.html" with card_group_title="Latest DBT news" cards=news_cards footer_link="/news-and-views/" footer_link_text="View all news" show_hr=True show_shadow=True %}
                {% endif %}

                {% if events %}
                    {% pages_to_cards events True as event_cards %}
                    {% if FEATURE_FLAGS.event_listing %}
                        {% include "dwds/components/card_group.html" with card_group_title="Events" card_group_link="/events/" card_group_link_text="View all events" cards=event_cards grid=True blue_bg=True %}
                    {% else %}
                        {% include "dwds/components/card_group.html" with card_group_title="Events" cards=event_cards grid=True blue_bg=True %}
                    {% endif %}
                {% endif %}

                {% if not hide_news %}
                    {% include "dwds/components/link_list.html" with title="DBT news from GOV.UK" list=govuk_feed %}
                {% endif %}
            </div>
        </section>
    </article>
{% endblock primary_content %}

{% block secondary_content %}
    <article>
        <section class="stack">
            {% if active_site_alert %}
                {% include 'dwds/components/banner_card.html' with text=active_site_alert.banner_text link=active_site_alert.banner_link %}
            {% endif %}
            {% include 'interactions/bookmark_card.html' %}
            {% if quick_links %}
                {% include "dwds/components/link_list.html" with title="Quick links" list=quick_links %}
            {% endif %}
        </section>
        {% comment %} <section>
            {% include "dwds/components/link_list.html" with title="Popular pages" list=whats_popular_items %}
        </section> {% endcomment %}
    </article>
{% endblock secondary_content %}
