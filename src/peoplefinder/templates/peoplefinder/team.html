{% extends "dwds_content.html" %}

{% load markdown %}

{% block title %}
    {{ page_title }}
{% endblock title %}

{% block page_title %}
{% endblock page_title %}

{% block primary_content_classes %}
{% endblock primary_content_classes %}

{% block primary_content %}
    <div class="content-stack large">
        <div class="dwds-content-item-card no-shadow">
            <div class="dwds-content-list content-item">
                <div class="content-main">
                    <div class="content-body content-body-space-padding content-stack">
                        <h1>
                            {{ page_title }}
                            {% if team.abbreviation %}({{ team.abbreviation }}){% endif %}
                        </h1>

                        <div class="text-small" data-testid="description">{{ team.description|markdown }}</div>
                        <div class="dwds-button-group">
                            {% if perms.peoplefinder.change_team %}
                                <a class="dwds-button dwds-button--secondary dwds-button--inline"
                                   href="{% url 'team-edit' team.slug %}"
                                   data-testid="edit-team">Edit team</a>
                            {% endif %}
                            {% if perms.peoplefinder.add_team %}
                                <a class="dwds-button dwds-button--secondary dwds-button--inline"
                                   href="{% url 'team-add-new-subteam' team.slug %}">Add new sub-team</a>
                            {% endif %}
                            {% if perms.peoplefinder.delete_team %}
                                {% if can_team_be_deleted %}
                                    <a class="dwds-button dwds-button--warning dwds-button--inline"
                                       href="{% url 'team-delete' team.slug %}">Delete team</a>
                                {% endif %}
                            {% endif %}
                        </div>
                        {% if perms.peoplefinder.delete_team %}
                            {% if not can_team_be_deleted %}
                                <div class="text-small">
                                    {% include 'peoplefinder/components/bullet-list.html' with introduction='This team cannot be deleted because it has' list=reasons_team_cannot_be_deleted %}
                                </div>
                            {% endif %}
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>

        {% if sub_views|length > 1 %}
            <div class="dwds-button-group">
                {% for sub_view in sub_views %}
                    <a class="dwds-button dwds-button--navigation {% if sub_view.value == current_sub_view %}active{% endif %}"
                       href="{% url 'team-view' team.slug %}?sub_view={{ sub_view.value }}">{{ sub_view.label }}</a>
                {% endfor %}
            </div>
        {% endif %}

        {% if leaders %}
            <h2>Team leader{{ leaders|length|pluralize }}</h2>
            <div class="content-grid grid-cards-auto-fill">
                {% for member in leaders %}
                    <div class="dwds-content-item-card">
                        {% include 'peoplefinder/components/team-member-card.html' with member=member %}
                    </div>
                {% endfor %}
            </div>
        {% endif %}

        {% if current_sub_view.value == "sub-teams" and sub_teams %}
            <h2>Teams within {{ team.short_name }}</h2>
            <div class="content-grid grid-cards-auto-fill">
                {% for team in sub_teams %}
                    <div class="dwds-content-item-card">{% include 'peoplefinder/components/team-card-new.html' with team=team %}</div>
                {% endfor %}
            </div>
        {% endif %}

        {% if current_sub_view.value == "people" and members %}
            <h2>People in {{ team.short_name }}</h2>
            <div class="content-grid grid-cards-auto-fill">
                {% for member in members %}
                    <div class="dwds-content-item-card">
                        {% include 'peoplefinder/components/team-member-card.html' with member=member %}
                    </div>
                {% endfor %}
            </div>
        {% endif %}

        {% if perms.peoplefinder.change_team and perms.peoplefinder.view_auditlog %}
            <details class="govuk-details" data-module="govuk-details">
                <summary class="govuk-details__summary">
                    <span class="govuk-details__summary-text">Audit log</span>
                </summary>
                <div class="govuk-details__text">
                    {% include 'peoplefinder/components/audit-log.html' with audit_log=team_audit_log.reverse %}
                </div>
            </details>
        {% endif %}
    </div>
{% endblock primary_content %}
