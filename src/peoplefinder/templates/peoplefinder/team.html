{% extends 'dwds_content.html' %}

{% load markdown %}

{% block title %}
    {{ page_title }}
{% endblock title %}

{% block page_title %}
{% endblock page_title %}

{% block primary_content %}
    <div class="content-stack large">
        <div class="dwds-content-item-card no-shadow">
            <div class="dwds-content-list content-item">
                <div class="content-main">
                    <div class="content-body content-body-space-padding content-stack">
                        <h1>{{ page_title }}</h1>
                        {% if team.abbreviation %}<p class="text-small">{{ team.abbreviation }}</p>{% endif %}
                        <div class="text-small" data-testid="description">{{ team.description|markdown }}</div>
                        <div class="dwds-button-group">
                            {% if perms.peoplefinder.change_team %}
                                <a class="dwds-button dwds-button--secondary dwds-button--inline"
                                   href="{% url 'team-edit' team.slug %}"
                                   data-testid="edit-team">Edit team</a>
                            {% endif %}
                            {% if perms.peoplefinder.add_team %}
                                <a class="dwds-button dwds-button--secondary dwds-button--inline"
                                   href="{% url 'team-add-new-subteam' team.slug %}">Add new sub-team</a>
                            {% endif %}
                            {% if perms.peoplefinder.delete_team %}
                                {% if can_team_be_deleted %}
                                    <a class="dwds-button dwds-button--warning dwds-button--inline"
                                       href="{% url 'team-delete' team.slug %}">Delete team</a>
                                {% endif %}
                            {% endif %}
                        </div>
                        {% if perms.peoplefinder.delete_team %}
                            {% if not can_team_be_deleted %}
                                <div class="text-small">
                                    {% include 'peoplefinder/components/bullet-list.html' with introduction='This team cannot be deleted because it has' list=reasons_team_cannot_be_deleted %}
                                </div>
                            {% endif %}
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>

        {% if team.leader_count %}
            <h2>Team leader{{ team.leader_count|pluralize }}</h2>
            <div class="content-grid grid-cards-auto-fill">
                {% for member in team.leaders %}
                    <div class="dwds-content-item-card">
                        <div class="dwds-content-list content-item">
                            <div class="content-main">
                                <div class="content-body content-body-space-padding content-stack large">
                                    {% include 'peoplefinder/components/team-member-card.html' with member=member %}
                                </div>
                            </div>
                        </div>
                    </div>
                {% endfor %}
            </div>
        {% endif %}

        {% if sub_teams %}
            <h2>Teams within {{ team.short_name }}</h2>
            <a href="{% url 'team-people' team.slug %}">View all people</a>
            <a href="{% url 'team-tree' team.slug %}">View all sub-teams</a>
            <a href="{% url 'team-people-outside-subteams' team.slug %}">View {{ people_outside_subteams_count }} people not assigned to a team</a>
            <div class="content-grid grid-cards-auto-fill">
                {% for team in sub_teams %}
                    <div class="dwds-content-item-card">
                        <div class="dwds-content-list content-item">
                            <div class="content-main">
                                <div class="content-body content-body-space-padding content-stack large">
                                    {% include 'peoplefinder/components/team-card.html' with team=team %}
                                </div>
                            </div>
                        </div>
                    </div>
                {% endfor %}
            </div>
        {% endif %}
        {% if members %}
            <h2>People in {{ team.short_name }}</h2>
            <div class="content-grid grid-cards-auto-fill">
                {% for member in members %}
                    <div class="dwds-content-item-card">
                        <div class="dwds-content-list content-item">
                            <div class="content-main">
                                <div class="content-body content-body-space-padding content-stack large">
                                    {% include 'peoplefinder/components/team-member-card.html' with member=member %}
                                </div>
                            </div>
                        </div>
                    </div>
                {% endfor %}
            </div>
        {% endif %}

        {% if perms.peoplefinder.change_team and perms.peoplefinder.view_auditlog %}
            <details class="govuk-details" data-module="govuk-details">
                <summary class="govuk-details__summary">
                    <span class="govuk-details__summary-text">Audit log</span>
                </summary>
                <div class="govuk-details__text">
                    {% include 'peoplefinder/components/audit-log.html' with audit_log=team_audit_log.reverse %}
                </div>
            </details>
        {% endif %}
    </div>
{% endblock primary_content %}
